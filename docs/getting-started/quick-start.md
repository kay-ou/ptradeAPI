# 快速入门

本文档将引导您完成从创建策略到运行交易的全过程，帮助您快速上手 Ptrade 量化交易平台。

## 1. 新建策略

开始之前，您需要先创建一个策略文件。

1.  在 Ptrade 客户端左侧的策略列表中，右键点击并选择“新建策略”。
2.  选择一个业务类型（如：股票），并为您的策略命名。
3.  创建成功后，系统会自动生成一个包含基础模板的策略文件，您可以开始编写代码。

## 2. 编写您的第一个策略

一个最简单的策略包含 `initialize` 和 `handle_data` 两个函数。

```python
# 策略代码：simple_strategy.py

def initialize(context):
    """
    初始化函数，在策略启动时运行一次。
    """
    # 设置要操作的股票池
    set_universe('600570.SS')
    log.info("策略初始化完成")

def handle_data(context, data):
    """
    策略主逻辑函数，按指定的频率（日或分钟）定时触发。
    """
    # 此处暂时不添加任何交易逻辑
    pass
```

-   **`initialize(context)`**: 初始化函数，用于设置策略的全局参数，如股票池、基准、手续费等。它在策略启动时仅执行一次。
-   **`handle_data(context, data)`**: 策略的核心逻辑所在，会根据您设置的频率（日或分钟）被反复调用。

## 3. 运行回测

策略编写完成后，通过回测来检验其在历史数据上的表现。

1.  在策略编辑界面，点击上方的“回测”按钮。
2.  设置回测参数：
    *   **开始/结束时间**: 定义回测的时间范围。
    *   **初始资金**: 设定回测的初始虚拟资金。
    *   **回测基准**: 选择一个指数作为策略表现的比较基准（如：沪深300）。
    *   **回测频率**: 选择 `日` 或 `分钟` 级别。
3.  点击“保存”并“开始回测”。系统将开始运行，并在完成后展示详细的回测报告，包括收益曲线、年化收益、最大回撤等关键指标。

## 4. 添加交易逻辑

现在，我们为一个简单的双均线策略添加交易逻辑。

```python
# 策略代码：dual_moving_average_strategy.py

def initialize(context):
    g.security = '600570.SS' # 设置股票代码
    set_universe(g.security)

def handle_data(context, data):
    # 获取过去10天的历史价格
    hist = get_history(10, '1d', 'close', g.security)
    
    # 计算5日和10日均线
    ma5 = hist[-5:].mean()
    ma10 = hist[-10:].mean()

    # 获取当前持仓
    position = get_position(g.security)

    # 金叉（5日线上穿10日线）且当前无持仓，则买入
    if ma5 > ma10 and position.amount == 0:
        # 获取账户可用现金
        cash = context.portfolio.cash
        # 全仓买入
        order_value(g.security, cash)
        log.info(f"买入 {g.security}")

    # 死叉（5日线下穿10日线）且当前有持仓，则卖出
    elif ma5 < ma10 and position.amount > 0:
        # 全部卖出
        order_target(g.security, 0)
        log.info(f"卖出 {g.security}")
```

-   **`g` 对象**: 一个全局对象，用于在策略的不同函数间传递和存储变量。
-   **`get_history()`**: 获取历史行情数据。
-   **`get_position()`**: 获取指定标的的持仓信息。
-   **`order_value()` / `order_target()`**: 下单函数，分别用于按价值下单和按目标数量下单。

## 5. 开启模拟/实盘交易

回测结果满意后，您可以将策略用于模拟交易或实盘交易。

1.  在主界面的“交易”模块中，点击“新增”按钮。
2.  在弹出的窗口中，选择您要运行的策略方案。
3.  为本次交易命名，然后点击“确定”启动。

交易启动后，您可以在交易详情中实时查看策略的运行状态、持仓、资金、日志等信息。

## 关键注意事项

-   **持久化**: 模拟和实盘交易中，策略可能会因服务器维护等原因中断。使用 `pickle` 等方式对重要变量（如持仓状态、自定义参数等）进行持久化，是保证策略重启后能继续正常运行的关键。
-   **异常处理**: 在代码中加入 `try...except` 块来捕获潜在的错误（如网络请求失败、数据格式错误等），可以大大增强策略的稳定性。
-   **代码精度**: 注意不同品种的价格精度。股票为2位小数，而可转债、ETF等为3位小数。在进行限价委托时，请确保价格精度正确。

## 下一步

-   浏览 **[策略示例库](examples.md)** 获取更多灵感。
-   查阅 **[API 参考](../api-reference/)** 了解每个函数的详细用法。
-   在 **[常见问题](../advanced/faq.md)** 中寻找答案。
